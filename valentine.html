---
layout: default
title: "For You"
---
<div class="valentine">
  <header class="valentine__hero">
    <h1>Going for a stroll</h1>
  </header>

  <section class="panel" id="auth-panel">
    <h2>Secret Check</h2>
    <p class="panel__hint">Answer the questions only you would know.</p>
    <div class="auth">
      <div class="auth__question" id="auth-question"></div>
      <input class="auth__input" id="auth-input" type="text" autocomplete="off" />
      <div class="auth__feedback" id="auth-feedback"></div>
      <button class="btn" id="auth-submit" type="button">Unlock</button>
    </div>
  </section>

  <section class="panel is-hidden" id="adventure-panel">
    <h2>Mini Walk</h2>
    <p class="panel__hint">Use the pad to move. Something is waiting ahead.</p>
    <div class="scene" id="scene">
      <div class="world" id="world">
        <div class="scene__sky"></div>
        <img class="bg-cloud" src="/assets/animations/backgrounds/nature_5/2.png" alt="" />
        <div class="scene__ground" id="ground">
          <div class="ground-decor" id="ground-decor"></div>
        </div>

        <img
          class="sprite sprite--zelda"
          id="zelda"
          src="/assets/animations/sanjana-walking-2/frame-1.png"
          alt="Zelda"
        />

        <div class="sprite sprite--link" id="link-right">
          <img
            class="link__sprite"
            id="link-sprite-right"
            src="/assets/animations/arvind-idle-then-flowers/frame-1.png"
            alt="Link"
          />
        </div>

        <div class="sprite sprite--link sprite--link-left is-hidden" id="link-left">
          <img
            class="link__sprite"
            id="link-sprite-left"
            src="/assets/animations/arvind-idle-then-flowers/frame-1.png"
            alt="Link"
          />
        </div>
      </div>

      <button class="interact-btn is-hidden" id="interact-btn" type="button">Talk</button>
      <button class="interact-btn is-hidden" id="interact-btn-left" type="button">Talk</button>

      <div class="dialog is-hidden" id="dialog">
        <div class="dialog__bubble">
          <strong>Arvind:</strong> Sanjana, will you be my valentine?
        </div>
        <div class="dialog__choices">
          <button class="btn btn--yes" id="yes-btn-a" type="button">Yes</button>
          <button class="btn btn--yes" id="yes-btn-b" type="button">Yes</button>
        </div>
      </div>
    </div>
    <div class="adventure__controls">
      <div class="dpad" role="group" aria-label="movement pad">
        <button class="dpad__btn" id="back-btn" type="button">◀</button>
        <button class="dpad__btn" id="forward-btn" type="button">▶</button>
        <button class="dpad__btn dpad__btn--jump" id="jump-btn" type="button">⤒</button>
      </div>
    </div>
    <div class="adventure__feedback" id="adventure-feedback"></div>
  </section>

  <section class="panel is-hidden" id="yes-panel">
    <h2>Yay! It's a date.</h2>
    <p class="panel__hint">I love you. Now let's celebrate together.</p>
    <div class="confetti" aria-hidden="true"></div>
  </section>
</div>

<style>
  :root {
    --rose-900: #2b0a1c;
    --rose-700: #5b1832;
    --rose-500: #b8345a;
    --rose-300: #f2b3c2;
    --cream: #fff7f2;
    --shadow: rgba(0, 0, 0, 0.25);
    --world-width: 2200px;
  }

  .valentine {
    min-height: 100vh;
    padding: 32px 18px 64px;
    background: radial-gradient(circle at top, #fff1f6, #f4c2d2 40%, #b8345a 100%);
    color: var(--rose-900);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 24px;
    font-family: "EB Garamond", serif;
  }

  .valentine button {
    opacity: 1;
    width: auto;
    font-family: "EB Garamond", serif;
  }

  .valentine__hero {
    text-align: center;
    max-width: 520px;
  }

  .valentine__eyebrow {
    letter-spacing: 0.2em;
    text-transform: uppercase;
    font-size: 12px;
    margin-bottom: 8px;
  }

  .valentine__sub {
    font-size: 18px;
    margin: 10px 0 0;
  }

  h1 {
    margin: 0;
    font-size: 34px;
  }

  h2 {
    margin: 0 0 10px;
    font-size: 28px;
  }

  .panel {
    width: min(560px, 94vw);
    background: var(--cream);
    border-radius: 20px;
    box-shadow: 0 18px 30px var(--shadow);
    padding: 22px;
    display: grid;
    gap: 12px;
    position: relative;
    overflow: hidden;
  }

  .panel__hint {
    margin: 0;
    font-size: 16px;
  }

  .auth {
    display: grid;
    gap: 10px;
  }

  .auth__question {
    font-size: 18px;
    font-weight: 600;
  }

  .auth__input {
    width: 100%;
    padding: 12px 14px;
    border-radius: 12px;
    border: 2px solid var(--rose-300);
    font-size: 16px;
  }

  .auth__feedback,
  .adventure__feedback,
  .final__feedback {
    min-height: 20px;
    font-size: 15px;
    color: var(--rose-700);
  }

  .btn {
    padding: 12px 16px;
    border-radius: 999px;
    border: none;
    background: var(--rose-500);
    color: white;
    font-size: 16px;
    cursor: pointer;
    box-shadow: 0 8px 16px rgba(184, 52, 90, 0.35);
    width: auto;
    opacity: 1;
  }

  .btn--ghost {
    background: #f3d7df;
    color: var(--rose-900);
  }

  .btn:active {
    transform: scale(0.98);
  }

  .btn--yes {
    background: #178c5c;
  }

  .btn--no {
    background: #a11a2f;
    position: relative;
  }

  .scene {
    position: relative;
    height: 400px;
    border-radius: 16px;
    overflow: hidden;
    border: 2px solid #f1bfd0;
    background: url("/assets/animations/backgrounds/nature_5/1.png") center/cover no-repeat;
  }

  .world {
    position: absolute;
    inset: 0;
    width: var(--world-width);
    height: 100%;
    transform: translateX(0);
    transition: transform 0.3s ease;
    z-index: 1;
  }

  .scene__sky {
    position: absolute;
    inset: 0;
    z-index: 0;
  }

  .bg-cloud {
    position: absolute;
    top: -200px;
    left: 0;
    width: 75%;
    height: auto;
    opacity: 0.95;
    image-rendering: pixelated;
    z-index: 1;
  }


  .scene__ground {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 160px;
    background: url("/assets/animations/backgrounds/nature_5/3.png") repeat-x bottom / auto 100%;
    z-index: 6;
  }

  .scene__ground::before {
    content: "";
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 240px;
    background: url("/assets/animations/backgrounds/nature_5/4.png") no-repeat left bottom / auto 100%;
    pointer-events: none;
  }

  .ground-decor {
    position: absolute;
    left: 0;
    right: 0;
    bottom: 0;
    height: 240px;
    pointer-events: none;
    z-index: 7;
  }

  .ground-decor__item {
    position: absolute;
    bottom: 0;
    height: 240px;
    width: auto;
    image-rendering: pixelated;
    transform: scale(2);
    transform-origin: bottom left;
  }

  .ground-decor__item.is-flipped {
    transform: scaleX(-1) scale(2);
    transform-origin: bottom left;
  }

  /* holes removed */

  .sprite {
    position: absolute;
    bottom: 52px;
    image-rendering: pixelated;
    z-index: 12;
  }

  .sprite--zelda {
    width: 72px;
    height: auto;
    left: 0;
  }

  .sprite--link {
    width: 86px;
    height: 96px;
    right: 0;
    transform: translateX(-80px) scale(1.05);
    display: grid;
    place-items: center;
    z-index: 20;
  }

  .sprite--link-left {
    right: auto;
    left: 20px;
    transform: scale(1.05);
  }

  .link__sprite {
    width: 86px;
    height: auto;
    image-rendering: pixelated;
    transform: scaleX(-1);
  }

  .sprite--link-left .link__sprite {
    transform: scaleX(1);
  }

  .interact-btn {
    position: absolute;
    transform: translateX(-50%);
    padding: 6px 12px;
    border-radius: 12px;
    border: none;
    background: #ffe5ef;
    color: #5b1832;
    font-weight: 600;
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.2);
    pointer-events: auto;
    z-index: 5;
    opacity: 1;
  }

  .interact-btn.is-hidden {
    display: none;
  }

  .dialog {
    position: absolute;
    bottom: 170px;
    width: min(320px, 80vw);
    display: grid;
    gap: 10px;
    text-align: center;
    z-index: 6;
  }

  .dialog__bubble {
    background: #fff;
    border-radius: 16px;
    padding: 12px 14px;
    box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
    font-size: 16px;
  }

  .dialog__choices {
    display: flex;
    gap: 12px;
    justify-content: center;
  }

  .adventure__controls {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
    justify-content: center;
  }

  .dpad {
    display: grid;
    grid-template-columns: repeat(3, 60px);
    gap: 10px;
    justify-content: center;
    margin-top: 8px;
  }

  .dpad__btn {
    width: 60px;
    height: 50px;
    border-radius: 14px;
    border: none;
    background: #ffe5ef;
    color: #5b1832;
    font-size: 18px;
    font-weight: 600;
    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.15);
    opacity: 0.95;
    touch-action: manipulation;
  }

  .dpad__btn:active {
    transform: translateY(1px);
  }

  .dpad__btn--jump {
    background: #fff2c4;
  }

  .confetti {
    height: 120px;
    background-image: radial-gradient(circle, #ff5fa2 20%, transparent 20%),
      radial-gradient(circle, #ffd166 20%, transparent 20%),
      radial-gradient(circle, #06d6a0 20%, transparent 20%),
      radial-gradient(circle, #118ab2 20%, transparent 20%);
    background-size: 24px 24px;
    animation: float 3s linear infinite;
  }

  .is-hidden {
    display: none;
  }

  @keyframes drift {
    0% { transform: translateX(0); }
    100% { transform: translateX(160px); }
  }

  @keyframes float {
    0% { background-position: 0 0, 6px 12px, 12px 6px, 18px 18px; }
    100% { background-position: 0 24px, 6px 36px, 12px 30px, 18px 42px; }
  }

  @media (max-width: 480px) {
    h1 { font-size: 28px; }
    h2 { font-size: 24px; }
    .panel { padding: 18px; }
    .scene { height: 220px; }
  }
</style>

<script>
  const authData = [
    { question: "Where did we have our first date?", answers: ["REPLACE_ME"] },
    { question: "What's my nickname for you?", answers: ["REPLACE_ME"] }
  ];

  const zeldaFrames = [
    "/assets/animations/sanjana-walking-2/frame-1.png",
    "/assets/animations/sanjana-walking-2/frame-2.png",
    "/assets/animations/sanjana-walking-2/frame-3.png",
    "/assets/animations/sanjana-walking-2/frame-4.png",
    "/assets/animations/sanjana-walking-2/frame-5.png",
    "/assets/animations/sanjana-walking-2/frame-6.png",
    "/assets/animations/sanjana-walking-2/frame-7.png",
    "/assets/animations/sanjana-walking-2/frame-8.png",
    "/assets/animations/sanjana-walking-2/frame-9.png",
    "/assets/animations/sanjana-walking-2/frame-10.png",
    "/assets/animations/sanjana-walking-2/frame-11.png",
    "/assets/animations/sanjana-walking-2/frame-12.png",
    "/assets/animations/sanjana-walking-2/frame-13.png",
    "/assets/animations/sanjana-walking-2/frame-14.png",
    "/assets/animations/sanjana-walking-2/frame-15.png",
    "/assets/animations/sanjana-walking-2/frame-16.png"
  ];

  const jumpFrames = [
    "/assets/animations/sanjana_jump/frame-1.png",
    "/assets/animations/sanjana_jump/frame-2.png",
    "/assets/animations/sanjana_jump/frame-3.png",
    "/assets/animations/sanjana_jump/frame-4.png",
    "/assets/animations/sanjana_jump/frame-5.png",
    "/assets/animations/sanjana_jump/frame-6.png"
  ];

  const sanjanaCelebrateFrames = [
    "/assets/animations/sanjana-celebrate/frame-1.png",
    "/assets/animations/sanjana-celebrate/frame-2.png",
    "/assets/animations/sanjana-celebrate/frame-3.png",
    "/assets/animations/sanjana-celebrate/frame-4.png",
    "/assets/animations/sanjana-celebrate/frame-5.png",
    "/assets/animations/sanjana-celebrate/frame-6.png",
    "/assets/animations/sanjana-celebrate/frame-7.png",
    "/assets/animations/sanjana-celebrate/frame-8.png",
    "/assets/animations/sanjana-celebrate/frame-9.png",
    "/assets/animations/sanjana-celebrate/frame-10.png",
    "/assets/animations/sanjana-celebrate/frame-11.png",
    "/assets/animations/sanjana-celebrate/frame-12.png",
    "/assets/animations/sanjana-celebrate/frame-13.png",
    "/assets/animations/sanjana-celebrate/frame-14.png",
    "/assets/animations/sanjana-celebrate/frame-15.png",
    "/assets/animations/sanjana-celebrate/frame-16.png"
  ];

  const linkIdleFrames = [
    "/assets/animations/arvind-idle-then-flowers/frame-1.png",
    "/assets/animations/arvind-idle-then-flowers/frame-2.png",
    "/assets/animations/arvind-idle-then-flowers/frame-3.png",
    "/assets/animations/arvind-idle-then-flowers/frame-4.png"
  ];

  const linkInteractFrames = [
    "/assets/animations/arvind-idle-then-flowers/frame-5.png",
    "/assets/animations/arvind-idle-then-flowers/frame-6.png",
    "/assets/animations/arvind-idle-then-flowers/frame-7.png",
    "/assets/animations/arvind-idle-then-flowers/frame-8.png",
    "/assets/animations/arvind-idle-then-flowers/frame-9.png",
    "/assets/animations/arvind-idle-then-flowers/frame-10.png",
    "/assets/animations/arvind-idle-then-flowers/frame-11.png",
    "/assets/animations/arvind-idle-then-flowers/frame-12.png",
    "/assets/animations/arvind-idle-then-flowers/frame-13.png",
    "/assets/animations/arvind-idle-then-flowers/frame-14.png",
    "/assets/animations/arvind-idle-then-flowers/frame-15.png",
    "/assets/animations/arvind-idle-then-flowers/frame-16.png"
  ];

  const celebrateFrames = [
    "/assets/animations/arvind-celebrate/frame-1.png",
    "/assets/animations/arvind-celebrate/frame-2.png",
    "/assets/animations/arvind-celebrate/frame-3.png",
    "/assets/animations/arvind-celebrate/frame-4.png",
    "/assets/animations/arvind-celebrate/frame-5.png",
    "/assets/animations/arvind-celebrate/frame-6.png",
    "/assets/animations/arvind-celebrate/frame-7.png"
  ];

  const authPanel = document.getElementById("auth-panel");
  const authQuestion = document.getElementById("auth-question");
  const authInput = document.getElementById("auth-input");
  const authFeedback = document.getElementById("auth-feedback");
  const authSubmit = document.getElementById("auth-submit");

  const adventurePanel = document.getElementById("adventure-panel");
  const adventureFeedback = document.getElementById("adventure-feedback");
  const backBtn = document.getElementById("back-btn");
  const forwardBtn = document.getElementById("forward-btn");
  const jumpBtn = document.getElementById("jump-btn");
  const zelda = document.getElementById("zelda");
  const linkRight = document.getElementById("link-right");
  const linkLeft = document.getElementById("link-left");
  const linkSpriteRight = document.getElementById("link-sprite-right");
  const linkSpriteLeft = document.getElementById("link-sprite-left");
  const interactBtn = document.getElementById("interact-btn");
  const interactBtnLeft = document.getElementById("interact-btn-left");
  const dialog = document.getElementById("dialog");
  const yesBtnA = document.getElementById("yes-btn-a");
  const yesBtnB = document.getElementById("yes-btn-b");
  const scene = document.getElementById("scene");
  const world = document.getElementById("world");
  const groundDecor = document.getElementById("ground-decor");

  const yesPanel = document.getElementById("yes-panel");

  let authIndex = 0;
  let position = 60;
  let frameIndex = 0;
  let walkTimer = null;
  let facing = 1;
  let hasReachedLink = false;
  let velocity = 0;
  let lastTime = 0;
  let linkIdleTimer = null;
  let activeLinkSprite = null;
  let activeLinkSide = null;
  let leftLinkActive = false;
  let rightLinkTalked = false;
  let isJumping = false;
  let jumpOffset = 0;
  let isCelebrating = false;
  const startPosition = 60;
  let linkAnimating = false;

  const normalize = (value) => value.trim().toLowerCase();

  const showAuthQuestion = () => {
    authQuestion.textContent = authData[authIndex].question;
    authInput.value = "";
    authFeedback.textContent = "";
    authInput.focus();
  };

  const checkAuth = () => {
    const answer = normalize(authInput.value);
    const valid = authData[authIndex].answers.some(
      (item) => normalize(item) === answer
    );

    if (valid) {
      authIndex += 1;
      if (authIndex >= authData.length) {
        authPanel.classList.add("is-hidden");
        adventurePanel.classList.remove("is-hidden");
        renderGroundDecor();
        updateZelda();
      } else {
        showAuthQuestion();
      }
    } else {
      authFeedback.textContent = "Hmm, try again.";
    }
  };

  const updateCamera = () => {
    const sceneWidth = scene.clientWidth;
    const worldWidth = world.clientWidth;
    const center = sceneWidth * 0.38;
    const maxOffset = worldWidth - sceneWidth;
    const offset = Math.min(Math.max(position - center, 0), maxOffset);
    world.style.transform = `translateX(${-offset}px)`;
    return offset;
  };

  const updateZelda = () => {
    zelda.style.transform = `translateX(${position}px) translateY(${jumpOffset}px) scaleX(${facing}) scale(1.2)`;
    const offset = updateCamera();
    const setAnchor = (anchorEl, targetEl, offsetX = 0, offsetY = 0) => {
      if (!anchorEl || !targetEl) return;
      const anchorRect = anchorEl.getBoundingClientRect();
      const sceneRect = scene.getBoundingClientRect();
      const anchorX = anchorRect.left - sceneRect.left + anchorRect.width / 2 + offsetX;
      const clampedX = Math.min(Math.max(anchorX, 90), sceneRect.width - 90);
      const anchorY = anchorRect.top - sceneRect.top + offsetY;
      targetEl.style.left = `${clampedX}px`;
      if (!Number.isNaN(anchorY)) {
        targetEl.style.top = `${anchorY}px`;
      }
      targetEl.style.transform = "translateX(-50%)";
    };

    if (!dialog.classList.contains("is-hidden")) {
      const anchor = activeLinkSide === "left" ? linkLeft : linkRight;
      setAnchor(anchor, dialog, -30, -80);
    }
    if (!interactBtn.classList.contains("is-hidden")) {
      setAnchor(linkRight, interactBtn, 0, -28);
    }
    if (!interactBtnLeft.classList.contains("is-hidden")) {
      setAnchor(linkLeft, interactBtnLeft, 0, -28);
    }
  };

  const startWalkAnimation = () => {
    if (walkTimer) return;
    walkTimer = setInterval(() => {
      frameIndex = (frameIndex + 1) % zeldaFrames.length;
      zelda.src = zeldaFrames[frameIndex];
    }, 80);
  };

  const stopWalkAnimation = () => {
    clearInterval(walkTimer);
    walkTimer = null;
    zelda.src = zeldaFrames[0];
  };

  const playJump = () => {
    if (isJumping) return;
    isJumping = true;
    if (jumpFrames.length === 0) {
      const duration = 600;
      const startTime = performance.now();
      const animate = (time) => {
        const t = Math.min((time - startTime) / duration, 1);
        jumpOffset = -100 * Math.sin(Math.PI * t);
        updateZelda();
        if (t < 1) {
          requestAnimationFrame(animate);
        } else {
          isJumping = false;
          jumpOffset = 0;
          updateZelda();
        }
      };
      requestAnimationFrame(animate);
      return;
    }

    let index = 0;
    const interval = setInterval(() => {
      zelda.src = jumpFrames[index];
      const t = index / (jumpFrames.length - 1);
      jumpOffset = -100 * Math.sin(Math.PI * t);
      updateZelda();
      index += 1;
      if (index >= jumpFrames.length) {
        clearInterval(interval);
        zelda.src = zeldaFrames[0];
        isJumping = false;
        jumpOffset = 0;
        updateZelda();
      }
    }, 200);
  };


  const playSanjanaCelebrate = () => {
    if (isCelebrating) return;
    isCelebrating = true;
    let index = 0;
    const interval = setInterval(() => {
      zelda.src = sanjanaCelebrateFrames[index];
      index += 1;
      if (index >= sanjanaCelebrateFrames.length) {
        clearInterval(interval);
        isCelebrating = false;
      }
    }, 140);
  };

  const startLinkIdle = () => {
    if (linkIdleTimer) return;
    let index = 0;
    linkIdleTimer = setInterval(() => {
      linkSpriteRight.src = linkIdleFrames[index];
      linkSpriteLeft.src = linkIdleFrames[index];
      index = (index + 1) % linkIdleFrames.length;
    }, 180);
  };

  const stopLinkIdle = () => {
    clearInterval(linkIdleTimer);
    linkIdleTimer = null;
  };

  const playLinkInteract = (onDone) => {
    stopLinkIdle();
    linkAnimating = true;
    let index = 0;
    const interval = setInterval(() => {
      if (activeLinkSprite) {
        activeLinkSprite.src = linkInteractFrames[index];
      }
      index += 1;
      if (index >= linkInteractFrames.length) {
        if (activeLinkSprite) {
          activeLinkSprite.src = linkInteractFrames[linkInteractFrames.length - 1];
        }
        clearInterval(interval);
        linkAnimating = false;
        if (typeof onDone === "function") onDone();
      }
    }, 420);
  };

  const playCelebrate = () => {
    if (!activeLinkSprite) return;
    linkAnimating = true;
    let index = 0;
    const interval = setInterval(() => {
      activeLinkSprite.src = celebrateFrames[index];
      index += 1;
      if (index >= celebrateFrames.length) {
        clearInterval(interval);
        linkAnimating = false;
      }
    }, 140);
  };

  const getLinkPositions = () => {
    const worldWidth = world.clientWidth;
    const linkAnchor = worldWidth - 220;
    return {
      trigger: linkAnchor - 120 * 0.65,
      stop: linkAnchor - 40 * 0.65,
      leftTrigger: 80
    };
  };

  const reachLink = (side) => {
    if (hasReachedLink) return;
    hasReachedLink = true;
    adventureFeedback.textContent = "Something is here...";
    if (side === "left") {
      dialog.classList.add("is-hidden");
      activeLinkSide = "left";
      interactBtnLeft.classList.remove("is-hidden");
    } else {
      dialog.classList.add("is-hidden");
      activeLinkSide = "right";
      interactBtn.classList.remove("is-hidden");
    }
    startLinkIdle();
    updateZelda();
  };

  const startMove = (dir) => {
    facing = dir >= 0 ? 1 : -1;
    velocity = dir * 150;
    startWalkAnimation();
    if (!dialog.classList.contains("is-hidden")) {
      dialog.classList.add("is-hidden");
      interactBtn.classList.add("is-hidden");
      interactBtnLeft.classList.add("is-hidden");
      hasReachedLink = false;
    }
  };

  const stopMove = () => {
    velocity = 0;
    stopWalkAnimation();
  };

  const tick = (time) => {
    if (!lastTime) lastTime = time;
    const delta = (time - lastTime) / 1000;
    lastTime = time;

    if (velocity !== 0) {
      const { trigger, stop, leftTrigger } = getLinkPositions();
      position = Math.min(Math.max(position + velocity * delta, 0), stop);
      updateZelda();
      if (velocity > 0 && position >= trigger && !rightLinkTalked) {
        activeLinkSprite = linkSpriteRight;
        activeLinkSide = "right";
        velocity = 0;
        stopWalkAnimation();
        reachLink("right");
      } else if (velocity < 0 && leftLinkActive && position <= leftTrigger) {
        activeLinkSprite = linkSpriteLeft;
        activeLinkSide = "left";
        velocity = 0;
        stopWalkAnimation();
        reachLink("left");
      }
    }

    requestAnimationFrame(tick);
  };

  authSubmit.addEventListener("click", checkAuth);
  authInput.addEventListener("keydown", (event) => {
    if (event.key === "Enter") checkAuth();
  });

  const bindHold = (button, dir) => {
    const start = (event) => {
      event.preventDefault();
      startMove(dir);
    };
    const stop = (event) => {
      event.preventDefault();
      stopMove();
    };
    button.addEventListener("mousedown", start);
    button.addEventListener("mouseup", stop);
    button.addEventListener("mouseleave", stop);
    button.addEventListener("touchstart", start, { passive: false });
    button.addEventListener("touchend", stop, { passive: false });
    button.addEventListener("touchcancel", stop, { passive: false });
  };

  bindHold(forwardBtn, 1);
  bindHold(backBtn, -1);
  jumpBtn.addEventListener("click", playJump);

  interactBtn.addEventListener("click", () => {
    interactBtn.classList.add("is-hidden");
    adventureFeedback.textContent = "...";
    if (!activeLinkSprite) {
      activeLinkSprite = linkSpriteRight;
      activeLinkSide = "right";
    }
    rightLinkTalked = true;
    playLinkInteract(() => {
      dialog.classList.remove("is-hidden");
      leftLinkActive = true;
      linkLeft.classList.remove("is-hidden");
      updateZelda();
      hasReachedLink = false;
    });
  });

  interactBtnLeft.addEventListener("click", () => {
    interactBtnLeft.classList.add("is-hidden");
    adventureFeedback.textContent = "...";
    activeLinkSprite = linkSpriteLeft;
    activeLinkSide = "left";
    playLinkInteract(() => {
      dialog.classList.remove("is-hidden");
      updateZelda();
    });
  });

  const acceptYes = () => {
    dialog.classList.add("is-hidden");
    playSanjanaCelebrate();
    playCelebrate();
    yesPanel.classList.remove("is-hidden");
  };

  const revealRightLink = () => {
    // Right link is always visible now.
  };

  yesBtnA.addEventListener("click", acceptYes);
  yesBtnB.addEventListener("click", acceptYes);


  const getWorldWidth = () => {
    const cssValue = getComputedStyle(document.documentElement)
      .getPropertyValue("--world-width")
      .trim();
    const parsed = parseInt(cssValue, 10);
    if (!Number.isNaN(parsed)) return parsed;
    return world.getBoundingClientRect().width || 2200;
  };

  const renderGroundDecor = () => {
    groundDecor.innerHTML = "";
    const worldWidth = getWorldWidth();
    const spacing = 300;
    const count = Math.ceil(worldWidth / spacing);
    for (let i = 0; i < count; i += 1) {
      const decor = document.createElement("img");
      decor.src = "/assets/animations/backgrounds/nature_5/4.png";
      decor.className = "ground-decor__item";
      // no flip to keep consistent orientation
      decor.style.left = `${i * spacing}px`;
      groundDecor.appendChild(decor);
    }
  };

  showAuthQuestion();
  renderGroundDecor();
  updateZelda();
  startLinkIdle();
  requestAnimationFrame(tick);
</script>
